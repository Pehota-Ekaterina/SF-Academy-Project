<template>
    <lightning-card title="Product Table">
        <lightning-button 
            label="New" 
            onclick={handleNewClick}
            slot="actions"
        ></lightning-button>

        <template if:true={showForm}>
            <div class="slds-m-around_large">
                <h2 class="slds-text-heading_medium">Create new product</h2>
                <lightning-record-edit-form 
                    object-api-name="ProductTable__c"
                    onsuccess={handleSaveSuccess}
                >
                    <lightning-messages></lightning-messages>
                    <lightning-input-field 
                        field-name="Name"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="Price__c"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="Amount__c"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="ProductType__c"
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="ReleaseDate__c"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="AddedDate__c"
                    > </lightning-input-field>

                    <lightning-button
                        label="Cancel"
                        onclick={handleCancelClick}
                        class="slds-m-around_small"
                    ></lightning-button>
                    <lightning-button
                        variant="brand"
                        label="Save"
                        type="submit"
                        class="slds-m-around_small"
                    ></lightning-button>

                </lightning-record-edit-form>
            </div>
        </template>

        <template if:true={editForm}>
            <div class="slds-m-around_large">
                <h2 class="slds-text-heading_medium">Edit product</h2>
                <lightning-record-edit-form
                    record-id={productId}
                    object-api-name="ProductTable__c"
                    onsuccess={handleEditSuccess}
                >
                    <lightning-messages></lightning-messages>
                    <lightning-input-field 
                        field-name="Name"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="Price__c"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="Amount__c"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="ProductType__c"
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="ReleaseDate__c"
                        required
                    > </lightning-input-field>
                    <lightning-input-field 
                        field-name="AddedDate__c"
                    > </lightning-input-field>

                    <lightning-button
                        label="Cancel"
                        onclick={handleCancelEditClick}
                        class="slds-m-around_small"
                    ></lightning-button>
                    <lightning-button
                        variant="brand"
                        label="Edit"
                        type="submit"
                        class="slds-m-around_small"
                    ></lightning-button>
                </lightning-record-edit-form>
            </div>
        </template>

        <div class="slds-m-around_large">
            <div if:false={isLoaded} class="slds-is-relative">
                <lightning-spinner></lightning-spinner>
            </div>
        </div>

        <div class="slds-m-vertical_large slds-scrollable">
            <lightning-input 
                type="search" 
                label="Search by name"
                class="slds-input_small slds-size_1-of-4 slds-m-around_large"
                value={search}
                onchange={handleSearchChange}
            ></lightning-input>
            <div class="slds-m-around_large">
                <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th scope="col">
                                <div 
                                    data-field="Name" 
                                    onclick={handleSort} 
                                    class="slds-th__action slds-text-link"
                                >
                                    Name
                                </div>
                            </th>
                            <th scope="col">
                                <div 
                                    data-field="Amount__c" 
                                    onclick={handleSort} 
                                    class="slds-th__action slds-text-link"
                                >
                                    Amount
                                </div>
                            </th>
                            <th scope="col">
                                <div 
                                    data-field="Price__c" 
                                    onclick={handleSort} 
                                    class="slds-th__action slds-text-link"
                                >
                                    Price
                                </div>
                            </th>
                            <th scope="col">
                                <div 
                                    data-field="ProductType__c" 
                                    onclick={handleSort} 
                                    class="slds-th__action slds-text-link"
                                >
                                    Product Type
                                </div>
                            </th>
                            <th scope="col">
                                <div 
                                    data-field="ReleaseDate__c" 
                                    onclick={handleSort} 
                                    class="slds-th__action slds-text-link"
                                >
                                    Release Date
                                </div>
                            </th>
                            <th scope="col">
                                <div 
                                    data-field="Available__c" 
                                    onclick={handleSort} 
                                    class="slds-th__action slds-text-link"
                                >
                                    Available
                                </div>
                            </th>
                            <th scope="col">
                                <div>Actions</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={visibleProducts} for:item="product">
                            <tr key={product.Id} class="slds-hint-parent">
                                <th scope="row">
                                    <div>{product.Name}</div>
                                </th>
                                <td>
                                    <div>{product.Amount__c}</div>
                                </td>
                                <td>
                                    <div>{product.Price__c}</div>
                                </td>
                                <td>
                                    <div>{product.ProductType__c}</div>
                                </td>
                                <td>
                                    <div>{product.ReleaseDate__c}</div>
                                </td>
                                <td>
                                    <div>{product.Available__c}</div>
                                </td>
                                <td>
                                    <div>
                                        <lightning-button-menu
                                            class="slds-button_size-small"
                                        >
                                            <lightning-menu-item
                                                value="Edit" 
                                                label="Edit"
                                                class="slds-button_size-small"
                                                onclick={handleEditClick}
                                                data-product-id={product.Id}
                                            ></lightning-menu-item>
                                            <lightning-menu-item 
                                                value="Delete" 
                                                label="Delete"
                                                class="slds-button_size-small"
                                                onclick={handleDeleteClick}
                                                data-product-id={product.Id}
                                            ></lightning-menu-item>
                                        </lightning-button-menu>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <div slot="footer">
            <c-pagination records={listProducts} onupdate={updateProductsHandler}></c-pagination>
        </div>
    </lightning-card>
</template>